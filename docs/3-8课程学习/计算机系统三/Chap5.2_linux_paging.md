# Chap5.2_linux_paging

期末考试肯定会有这样的题目

SATP 寄存器会保存当前使用的虚拟地址模式

我们来看一下在 SV39 模式下，虚拟地址 0xffff ffc0 1357 9bdf 是如何映射到 物理地址 0x9377 9bdf 的。

首先我们有一个 satp 寄存器，这个寄存器中保存了 mode, asid，最初始的 PPN（physical page table）。在这里，我们假设我们的 PPN 是 0x80100。

![](img/4c7b65fea3d941d85324524b4e2d1c1f_MD5.png)

在 SV39 模式下，最外层的是 2。我们查看虚拟地址的 38-30 位，

ffc0 (32)|(31) 1 357

![](img/ccd819d78623a454bba983ea2fb353c9_MD5.png)

因此我们可以得到 38-30 是 100000000，及我们获得了我们的 VPN 是 100000000。这里的 VPN 代表的是，它在 page table 中是第几个 entry。我们知道在 RISV64 中，一个 page table entry 占用的是 8 个字节，因此实际的地址偏移是 100000000 $*$ 8 = 800000000 = 0x800。

因此我们知道此时虚拟地址对应的一级页表项地址为 0x80100 $*$ 4k + 0x800 = 0x80100800。我们访问这个物理地址，就可以得到页表项内容，假设内容为 0x0000 0000 2004 0401。

那么我们可以看到，X=W=R=0，这说明了下一级仍然是页表。

我们查看 PPN（整个 PPN 段）可以得到 0x 1000 0000 0001 0000 0001, 即 0x80101。我们查看 VPN$[$ 1 $]$ 可以得到 0x96。因此我们的二级页表的实际物理地址为 0x80101 $*$ 4k + 0x96 $*$ 8 = 0x801014b0。假设这个地址处的内容为 0x00000000_20040801。

同样的，X=W=R=0，这说明了下一级仍然是页表。

查看 PPN 可以得到 = 0x8010 2，查看 VPN $[$ 0 $]$ 可以得到 0x179，因此实际的物理地址为 0x80102bc8，我们假设页表项的内容为 0x00000000_24dde40f。

这个时候我们看到 v = r = w = x = 1，也即下一级就是实际的物理地址了。我们的 PPN $*$ 4k + page offset 就可以得到实际的物理地址。
