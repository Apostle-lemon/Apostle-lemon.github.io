# 42 优先编写表驱动的测试

在这一节中，我们聚焦于测试函数内部的代码应该如何编写。

## Go 测试代码的一般逻辑

构造特定的输入数据，比较实际结果值 actual 与期望值 except，如有差异，则通过 testing.Error 输出差异信息。

## 表驱动的测试实践

我们可以设计一个结构切片，其中包含了输入和期望的输出。如果我们需要新的测试，我们只需要在切片中增加数据条目即可。在切片定义的后面的代码中，我们会通过 for 循环，来对在切片中的每一项执行被测代码，看被测代码输出是否与期望输出相一致。这种测试设计中，这种自定义结构体的切片就被我们称之为“表”，其中自定义结构体类型的字段被我们称之为“列”。基于这个数据表的测试设计和实现则被称为“表驱动的测试”。

## 表驱动测试的优点

（1）简单紧凑。
（2）数据即测试。
（3）结合子测试后，可以单独运行某个数据项的测试。

## 表驱动测试实践中的注意事项

（1）我们可以用 map 代替 slice 进行表的构建，但是使用 map 时要注意，map 表内测试的先后顺序是不一样的。
（2）因为引发 error 的行数是相同的，因此需要在 error 中输出足够多的信息。例如输出 表明当前数据项在表中的偏移 tableOffset，或者直接输出当前数据项的名字 name。
