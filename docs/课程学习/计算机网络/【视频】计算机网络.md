# [视频] 计算机网络

## 介质访问控制子层

数据链路层 data link layer 分为了两个子层，LLC Logical link control，MAC medium access control sublayer。

因为 **广播信道** 会有冲突的可能，所以需要介质访问控制。

### 广播信道传输协议

#### Static FMD / TDM

做频分复用或者是时分复用。缺点是①非常浪费，不能有效利用信道资源。②在原有基础上不能有效进行拓展。

#### ALOHA

ALOHA, additive links on-line hawaii area。对没有 hawaii 代表的就是夏威夷。

##### Pure ALOHA

每个用户有数据需要发送时就传输。两个用户发送的信号重叠，被称为“冲突”。采用了可能引起冲突的共享信道方式的系统称为竞争系统 contention system。

发送方检测到接收方发回来的帧，若与预期（可能是 ACK/NAK，也能是将收到的帧重新返回）不同则是发生了冲突。如果发送方检测到了冲突，会等待一段 随机时间 后再次发送该帧。

在最好的情况下，pure aloha 的信道利用率为 1/2e ≈ 18%

##### Slotted ALOHA

把时间分成若干个槽。每个用户在 slot 开始的时候才能发送帧。在最好的情况下，其信道利用率为 1/e

#### CSMA

载波侦听多址访问，Carrier Sense Multiple Access

发之前听一下是否有人在发。

##### 1-persistent CSMA

如果信道为忙，则在空闲后的一瞬间，将想要发送的信号发送出去。

##### Nonpersistent CSMA

如果信道是忙的，则随机过一段时间，再来监听信道是否为忙的。

##### P-persistent CSMA

工作在 slotted channels，我的时间是分槽的。如果信道为忙，则到下一个 slot 再侦听。如果信道为空闲的，则以 p 的概率发送数据，以 1-p 的概率到下一个 slot 再侦听。

##### CSMA/CD, CSMA with Collision Detection

最长时间为 2τ，τ 为最远的两个站之间的传播用时。每个帧占用的时间必须为 2t 的整数倍。

#### 无冲突协议

- 基本位图协议 Basic Bit-map Protocal

每个竞争期含有 N 个槽，如果 0 号站有一帧要发送，则在 0 号槽中传输一位。在实际传输之前先广播自己有传输愿望的协议为预留协议 reservation protocal。

- 令牌环协议 Token Ring Protocal

每一个时刻，只有一个人持有 token。即只有一个人可以发信息。

- 二进制倒计时协议 Binary Countdown Protocal

每个站是有编号的，只有编号最大的站才有发消息的权利。

#### 有限竞争协议

- 自适应树遍历协议

逐渐将权限下放给站。每次给的站除以 2。

### 以太网

#### 经典以太网 Classic Ethernet

##### 物理层

以太网的每个版本都有电缆长度的限制，超过这个限制的网络可以通过中继器 repeater 将多条线缆连接起来。

###### 集线器 Hub

将多个 port 连接的 line 汇集成一个。方便了设备的增减，问题也更容易定位。

##### 传输协议

以太网是一种无连接无确认的传输。以太网使用 1-persistent CSMA/CD 算法进行传输。通过二进制指数后退算法 binary exponential backoff 确定每次冲突后的等待时间。

##### 帧结构

前 8 个字节为前导码 preable，其中前 7 个字节 10101010 用来同步，第八个字节是 10101011（SOF，start of frame）提示帧的开始。Dest addr 发出的第一个 bit 表示单播 unicasting，1 表示组播 multicasting，全 1 表示广播 boardcasting。Src addr 是全球唯一的，由 IEEE 统一分配。前 3 字节为 OUI，organizationally unique identifier。Pad 用来补充，防止不足 2τ\* 带宽 的情况出现。

10Base2 10 指的是速率为 10 Mbps。Base 指的是基带运输。Base2 Base5 都代表同轴电缆。Base C, Base T 是双绞线。

#### 网桥 Bridge

若干个 LAN 之间希望有一些信息交流。可以使用一根电缆连接这些 LAN，但这样会引发一系列问题。

- 广播到所有的 LAN，加重了网络的负载。
- 最长的线路长度需要受到限制
- 两个 LAN 的网络类型，线路速度类型未必是一样的，兼容的

##### 工作原理

网桥工作在 混杂模式 promiscuous mode 下。捕捉所有发送给它的数据。如果发送方和接收方不在同一个端口下，那么网桥就会进行一个转发。

网桥在转发之前需要知道每个站点在哪个端口。网桥中配备了哈希表。收到一个帧时，得知发送站点到端口的映射（这种自学习方法成为后向学习法 backward learning）。如果目的站点不在哈希表中，则网桥采用 flooding algorithm，将这一帧发送给除了发送端口以外的所有端口。

由于网络的拓扑结构会发生改变，所以表内每一项会有一个 产生/更新 的时间。会有进程将过久没更新的表项删除。直通式交换 cuthrough switching，虫孔路由 wormhole routing。

##### 冗余链路 Redundant Links / Parallel Links

为了提高可靠性，网桥之间可以使用冗余电路。但是这样子在网络拓扑之中是会产生环路的。为了解决这个问题，方法是生成树算法 spaning tree algorithm，通过不使用一些链路让图简化为一个无环的连通结构。

由于网桥的转发作用，站被隔离为左右两边，他们之间不会发生冲突。我们称可能会相互冲突的节点的集合为 冲突域 collision domain。连接在网桥同一端口上的所有站属于一个冲突域。

网桥工作在数据链路层，因为其会查看 MAC 地址，但是不会检查 IP 地址。

##### 交换式以太网 Switched Ethenet

交换机 switch 是现代网桥的另外一个称呼。现在的以太网都是全双工，点对点的，因此冲突不可能发生。

#### VLAN Virtual Local Area Network

通过改变逻辑结构而不是物理层面的结构来划分 LAN。VLAN 基于 VLAN-aware switches。支持 VLAN 的标准为 IEEE 802.1Q。同时为了适应这个帧结构，帧长的上限被调整到了 1522 字节。

VLAN 和组播有所不同。组播仍然会收到信息，但是会检查自己在不在组内，如果不在组内则不接受这条消息。但是通过 VLAN 则不在同一 VLAN 下面的不会收到信息。

### WLAN

无线局域网。有传播范围这个概念，信道嘈杂错误率高，无法做到监听冲突。确认成功发出需要 ACK

#### 一些问题

##### 隐藏终端问题

由于存在传播范围，竞争者感受不到另外一个竞争者，产生数据冲突。

##### 暴露终端问题

发送者会把范围内的其他发送者误认为是发送往同一目的地的竞争者。

以上两个问题的本质，发送端只知道自身周围是否有其他无线电信号干扰。但最终决定信号发送是否成功的，是由接收端附近是否有其他信号干扰决定的。

#### 冲突避免多路访问 MACA Multiple Access with Collision Avoidance

A 想要给 B 发送数据前，先发送一个 **RTS, Request to Send**，并在其中包含目标 B 和想要发送的数据帧的长度（表明了这个信息要发送多少时间）；B 在收到这个 RTS 后，回复一个 **CTS, Clear to Send**，其中也包含从 RTS 中得知的这个长度；A 在收到 CTS 后开始传输。需要注意的是，A 的传播范围内的所有站都会听到这个 RTS；听到 RTS 的站就会得知：它们离 A 足够近，因此为了避免与 A 收到的 CTS 发生冲突，它必须保持沉默，直到 A 开始发送信息。同样的，听到 CTS 的所有站都将会知道：在未来的一段时间（可以从 CTS 中的长度推测）内，它们必须保持沉默，否则就会与 B 收到的信息发生冲突。

#### IEEE 802.11

2.4Ghz 和 5 Ghz 两个频段。
