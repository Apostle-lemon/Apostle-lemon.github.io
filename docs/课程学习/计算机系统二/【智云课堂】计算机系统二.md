# [智云课堂] 计算机系统二

## Course Infomation and Policy

课堂上以 linux 操作系统为例，具体实现方式视不同操作系统为准。

### 推荐书籍

- Operating System Concepts - 10th
- Opearating System : Three Easy Pieces

在这两本书之中，老师更推荐第二本书。第一本书会介绍很多以前的计算机操作系统应当如何进行设计的内容。操作系统是与硬件紧密耦合的，但是当时的硬件系统，在今天来看只能得知一个概念，这使得学习非常得肤浅，不能 make your hands dirty（进行实践）。而第二本书，不仅更加前沿，并且更加通俗易懂。

害，这里老师说虽然不推荐第一本书，但还是选择在第一本书上选择题目，因为有些题目题型虽然无聊，但是会在考研题目出现，为了防止我们吃亏，还是在这本书上进行出题。

独立完成并不代表自己闷头做，不和同学交流，不向他人求助。

周老师的这些观点，我是非常认同的，我自己的学习经历得出的是同样的结论。

## Introduction

### Operating System Definition

Kernal 内核，is the program running at all times on the computer。运行在特权态，管理分配硬件资源。`这门课的‘操作系统’是指这个，而不包括 system program` 操作系统存放在 disk 上，运行时被加载到内存当中，由 CPU 进行执行。

### Hardware Components

Direct Memory Access DMA 部件。可以直接控制 memory。DMA 和 CPU 都可以直接访问 memory，这可能会产生数据不一致性。这个数据不一致性可以由硬件协议加以解决。

### Devices

devices controller 设备控制器。每一个设备控制器会存在一个 local buffer。I/O 是发生在 device 和设备控制器的 buffer 之间的。CPU 的数据移动是在 main memory 和设备控制器的 buffer 之间。

CPU 想要控制 devices controller，可以通过两种方式进行操作。第一种是通过特定的 io instruction，这种指令后便会跟 port 的地址。这是一种现代很少见的方式。今天的主流方式是 MMIO，Memory map IO,内存映射型 IO 访问。

### Interrupts and Traps

interrupt vector 中断向量，一个由 service routines 地址组成的表格。dispatch 中断分发。
interrupt handler 会存储被中断时候的状态

trap。类似于 system call，devided-by-zero 都会触发 trap。trap 也可以被理解为 soft-interrupt，即软中断。中断不加前缀词通常指的是硬中断。

操作系统是 interrupt-driven 的。有一种中断为 timer 定时器中断，有了定时器中断才可以有内核代码的执行，进行资源的调度。

### Interrupt Handling

有两种方式可以处理中断。polling 和 vectored interrupt system。

### IO From System Call to Devices, and Back

步骤大致为如下

- program 进行 system call 获得 system resources
- 操作系统发送 io requests
	- io requests 被发送给 device driver，之后会发送给 controller
- OS 可能会让程序等待 block,这种方式叫做同步 IO，也可能直接返回程序，这种方式叫做异步 IO
- IO 结束，IO 控制器 interupt OS
- OS 处理 IO 的结果，之后 wakes up the program，或者向程序发送一个 signal

### DMA Direct Memory Access

DMA 是高速 IO 设备用来传输数据的，可以以一种接近 memory speed 的速度进行 io。device 会发送一个 io descriptor 给 controller。这个 io descriptor 内部含有 operation type, memory address 之类的信息。controller 可以通过 DMA，直接在 local buffer 和 main memory 之间进行数据转移，而不需要 CPU intervention。
